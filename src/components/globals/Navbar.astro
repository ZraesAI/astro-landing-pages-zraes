---
import { ChevronRight } from "@lucide/astro";

export interface SubSubItem {
  name: string;
  href: string;
}

export interface SubItem {
  name: string;
  href: string;
  subSubItems?: SubSubItem[];
}

export interface MenuItem {
  name: string;
  href: string;
  subItems?: SubItem[];
}

const menuItems: MenuItem[] = [
  { name: "BERANDA", href: "/" },
  {
    name: "TENTANG KAMI",
    href: "/profil",
    subItems: [
      { name: "Profil Yayasan", href: "/profil" },
      { name: "Sambutan Ketua", href: "/profil#sambutan" },
      { name: "Sejarah Yayasan", href: "/profil#sejarah" },
    ],
  },
  {
    name: "PROGRAM",
    href: "/program",
    subItems: [
      { name: "Program Sosial", href: "/program#sosial" },
      { name: "Program Kemanusiaan", href: "/program#kemanusiaan" },
      { name: "Program Keagamaan", href: "/program#keagamaan" },
    ],
  },
  {
    name: "BERITA",
    href: "/berita",
  }
];
---

<div class="w-full fixed top-0 left-0 right-0 z-[100] transition-all duration-500 ease-out" id="navbar-wrapper">
  <nav class="w-full flex justify-between items-center px-6 2xl:px-8 py-3 bg-[#388E3C] shadow-lg relative z-[100] transition-all duration-500 ease-out" id="navbar">
    <div class="w-full max-w-7xl mx-auto flex justify-between items-center">
      <a href="/" class="cursor-pointer hover:opacity-80 transition-opacity duration-200 ease-out active:opacity-70 flex-shrink-0">
        <span class="text-xl md:text-2xl font-bold tracking-wider">
          <span class="bg-gradient-to-r from-[#81D4FA] via-[#FFD180] to-[#FFD700] bg-clip-text text-transparent"> SAWIYAN </span>
        </span>
      </a>

      <div class="hidden xl:flex items-center gap-6 text-white font-semibold xl:text-[0.800rem]">
        {
          menuItems.map((item) => (
            <div class={`relative group ${item.subItems && "cursor-pointer"}`}>
              <a href={item.href} class={`hover:text-[#FFD180] transition-colors duration-200 ease-out ${!item.subItems && "cursor-pointer"}`}>
                {item.name}
                {item.subItems && (
                  <svg class="inline w-4 h-4 ml-1 transition-transform duration-300 ease-out group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                )}
              </a>
              {item.subItems && (
                <div class="absolute top-full left-1/2 -translate-x-1/2 w-56 bg-[#388E3C]/95 backdrop-blur-sm text-white shadow-xl rounded-lg mt-2 z-[110] border border-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 ease-out transform translate-y-2 group-hover:translate-y-0">
                  <div class="py-2">
                    {item.subItems.map((subItem) => (
                      <div class="relative group/sub">
                        <a href={subItem.href} class="w-full flex justify-between items-center px-4 py-2 text-white hover:bg-[#81D4FA]/20 hover:text-[#FFD180] transition-all duration-200 ease-out">
                          {subItem.name}
                          {subItem.subSubItems && <ChevronRight class="w-4 h-4 transition-transform duration-300 ease-out group-hover/sub:translate-x-1" />}
                        </a>

                        {subItem.subSubItems && (
                          <div class="absolute top-0 left-full w-56 bg-[#388E3C]/95 backdrop-blur-sm text-white shadow-xl rounded-lg ml-2 z-[120] border border-white/10 opacity-0 invisible group-hover/sub:opacity-100 group-hover/sub:visible transition-all duration-300 ease-out transform -translate-x-2 group-hover/sub:translate-x-0">
                            <div class="py-2">
                              {subItem.subSubItems.map((subSubItem) => (
                                <a href={subSubItem.href} class="block px-4 py-2 text-white hover:bg-[#81D4FA]/20 hover:text-[#FFD180] transition-all duration-200 ease-out hover:pl-5">
                                  {subSubItem.name}
                                </a>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          ))
        }
      </div>

      <div class="xl:hidden flex gap-1 md:gap-2 justify-center items-center">
        <button id="hamburger-button" class="text-white focus:outline-none transition-transform duration-300 ease-out active:scale-90">
          <svg id="hamburger-icon" class="md:w-8 md:h-8 w-6 h-6 transition-transform duration-300 ease-out" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <div id="mobile-menu" class="fixed top-0 left-0 w-full h-full bg-[#388E3C] z-[100] transform -translate-y-full transition-transform duration-500 ease-in-out xl:hidden overflow-y-auto">
    <div class="mt-[50px]">
      <div class="flex flex-col text-white text-md font-semibold">
        {
          menuItems.map((item) => (
            <div class="border-b border-gray-100/30 px-7 py-4 transition-colors duration-200 hover:bg-white/5">
              {!item.subItems ? (
                <a href={item.href} class="block w-full hover:text-[#FFD180] transition-colors duration-200 ease-out">
                  {item.name}
                </a>
              ) : (
                <div>
                  <button class="accordion-toggle flex justify-between items-center w-full hover:text-[#FFD180] transition-colors duration-200 ease-out">
                    <span>{item.name}</span>
                    <svg class="w-5 h-5 transition-transform duration-300 ease-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                  <div class="accordion-panel max-h-0 overflow-hidden transition-all duration-500 ease-in-out">
                    <div class="py-3.5 px-4 mt-4 flex flex-col gap-3 bg-[#81D4FA]/20 rounded-lg">
                      {item.subItems.map((subItem) =>
                        !subItem.subSubItems ? (
                          <a href={subItem.href} class="block py-1 text-base font-medium text-gray-200 hover:text-white hover:pl-2 transition-all duration-200 ease-out">
                            {subItem.name}
                          </a>
                        ) : (
                          <div>
                            <button class="accordion-toggle flex gap-3 items-center w-full py-1 text-base font-medium text-gray-200 hover:text-white transition-colors duration-200 ease-out">
                              <span>{subItem.name}</span>
                              <svg class="w-5 h-5 transition-transform duration-300 ease-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                              </svg>
                            </button>
                            <div class="accordion-panel max-h-0 overflow-hidden transition-all duration-500 ease-in-out">
                              <div class="pl-4 py-2 mt-2 flex flex-col gap-2 bg-[#81D4FA]/30 rounded-lg">
                                {subItem.subSubItems.map((subSubItem) => (
                                  <a href={subSubItem.href} class="block py-1 text-sm font-medium text-gray-300 hover:text-white hover:pl-2 transition-all duration-200 ease-out">
                                    {subSubItem.name}
                                  </a>
                                ))}
                              </div>
                            </div>
                          </div>
                        )
                      )}
                    </div>
                  </div>
                </div>
              )}
            </div>
          ))
        }
      </div>
    </div>
  </div>

  <script>
    const hamburgerButton = document.getElementById("hamburger-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const navbarWrapper = document.getElementById("navbar-wrapper");
    const hamburgerIcon = document.getElementById("hamburger-icon");

    hamburgerButton!.addEventListener("click", () => {
      const isMenuOpen = !mobileMenu!.classList.contains("-translate-y-full");

      if (isMenuOpen) {
        mobileMenu!.classList.add("-translate-y-full");
        hamburgerIcon!.classList.remove("rotate-90");
      } else {
        mobileMenu!.classList.remove("-translate-y-full");
        hamburgerIcon!.classList.add("rotate-90");
      }
    });

    // Logika untuk Akordeon dengan animasi smooth
    const accordions = document.querySelectorAll(".accordion-toggle");
    accordions.forEach((accordion) => {
      accordion.addEventListener("click", () => {
        const panel = accordion.nextElementSibling as HTMLElement;
        const icon = accordion.querySelector("svg");

        if (panel.style.maxHeight && panel.style.maxHeight !== "0px") {
          // Tutup panel
          panel.style.maxHeight = "0px";
          icon!.classList.remove("rotate-180");
        } else {
          // Buka panel
          panel.style.maxHeight = panel.scrollHeight + "px";
          icon!.classList.add("rotate-180");
        }
      });
    });

    let lastScrollY = window.scrollY;
    let ticking = false;

    const updateNavbar = () => {
      const currentScrollY = window.scrollY;
      updateNavbarStyle();
      lastScrollY = currentScrollY;
      ticking = false;
    };

    const onScroll = () => {
      if (!ticking) {
        window.requestAnimationFrame(updateNavbar);
        ticking = true;
      }
    };

    window.addEventListener("scroll", onScroll, { passive: true });

    const updateNavbarStyle = () => {
      const navbar = document.getElementById("navbar");
      const navbarWrapper = document.getElementById("navbar-wrapper");
      const navbarContent = navbar?.querySelector("div");

      if (!navbar || !navbarWrapper) return;

      if (window.scrollY < 50) {
        navbarWrapper.classList.remove("px-4", "py-4", "flex", "justify-center");
        navbarWrapper.classList.add("px-0", "py-0");
        navbar.classList.remove("bg-[#388E3C]/90", "backdrop-blur-md", "rounded-full", "border", "border-white/20");
        navbar.classList.add("bg-[#388E3C]", "rounded-none");
        if (navbarContent) {
          navbarContent.classList.add("max-w-7xl", "mx-auto");
        }
      } else {
        navbarWrapper.classList.remove("px-0", "py-0");
        navbarWrapper.classList.add("px-4", "py-4", "flex", "justify-center");
        navbar.classList.remove("bg-[#388E3C]", "rounded-none");
        navbar.classList.add("bg-[#388E3C]/90", "backdrop-blur-md", "rounded-full", "border", "border-white/20");
        if (navbarContent) {
          navbarContent.classList.add("max-w-7xl", "mx-auto");
        }
      }
    };

    updateNavbarStyle();
  </script>
</div>
